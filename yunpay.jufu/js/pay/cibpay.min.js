$(function(){var a=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?decodeURI(c[2]):null},b=function(a,b){var d,c="";return c=b?/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,2})?$/:/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){0,2})?$/,d=c.test(a)},c=function(){return localStorage.getItem("spp_payUserId")||""},d=function(a){localStorage.setItem("spp_payUserId",a)},e=function(){o.showLoading("付款成功,正在跳转..."),setTimeout(function(){location.href="/#/merchants/merchantspaySucceed"},100)},f=function(){o.showLoading("付款失败,正在跳转..."),setTimeout(function(){location.href="/#/pay/fail"},100)},g=function(a,b){var c={successFun:function(){e(b)},errorFun:function(){f(b)},cancelFun:function(){o.hideLoading()}},d=function(a,b){var c={successFun:"",errorFun:"",cancelFun:""},d=$.extend(c,b);WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp,nonceStr:a.nonceStr,"package":a.package,signType:"MD5",paySign:a.paySign},function(a){"get_brand_wcpay_request:ok"==a.err_msg?d.successFun&&d.successFun():"get_brand_wcpay_request:cancel"==a.err_msg?d.cancelFun&&d.cancelFun():d.errorFun&&d.errorFun()})};"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",d(a,c),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",d(a,c)),document.attachEvent("onWeixinJSBridgeReady",d(a,c))):d(a,c)},h=function(a,b){var c={tradeNO:a.tradeNO};AlipayJSBridge.call("tradePay",c,function(a){"9000"==a.resultCode?e(b):f(b)})},i=function(a,b){mqq.tenpay.pay(a,function(a){a&&0==a.resultCode?e(b):a&&-1==a.resultCode?o.hideLoading():f(b)})},j=function(a){var b=$("#amount").val(),c=$("#amount").val();switch(a){case"10":""===b?b="100":-1==b.indexOf(".")&&(b+="00");break;case"11":""===b&&(b="0"),b+=".";break;default:b=b+""+a}$("#amount").val(b),0==b.indexOf("0")&&b[1]&&"."!=b[1]&&$("#amount").val(b[1]),b.indexOf(".")!=b.lastIndexOf(".")&&$("#amount").val(c),b.indexOf(".")>-1&&b.length-b.indexOf(".")>3&&$("#amount").val(c),b.indexOf(".")>-1&&3==b.length-b.indexOf(".")&&"0"==b[b.length-1]&&$("#amount").val(c),b>99999.99&&$("#amount").val(c)},k=a("shopName")||"获取店铺信息失败,请重新扫描",l=a("code"),m=a("qrId"),n="skapi3.taidupay.com",o={dialogShow:function(a,b,c){$("#"+a).removeClass("hide").find("span").html(b),$("#backdrop").removeClass("hide"),setTimeout(function(){$("#"+a).addClass("hide"),$("#backdrop").addClass("hide"),c&&c()},2e3)},tipsError:function(a,b){this.dialogShow("tipsDialogError",a,b)},tipsSuccess:function(a,b){this.dialogShow("tipsDialogSuccess",a,b)},showLoading:function(a){a=a||"数据加载中",$("#loading").removeClass("hide").find("p").html(a),$("#backdrop").removeClass("hide")},hideLoading:function(){$("#loading").addClass("hide"),$("#backdrop").addClass("hide")}};$("#title").html(k),$("#amount").on("keyup",function(){var a=$("#amount").val();return""==a&&$("#showAmount").html("￥0"),""==a||b(a)?(a&&$("#showAmount").html("￥"+a),void 0):(o.tipsError("请输入正确的支付金额"),!1)}),$("#keyboard").find(".key-input").each(function(a,b){b.onclick=function(){var a="";switch($(this).html()){case"00":a="10";break;case".":a="11";break;default:a=$(this).html()}j(a)}}),$("#clear-amount").on("click",function(){$("#amount").val("")}),$("#save").on("click",function(){var a,e;return m?(a=$("#amount").val(),"."==a[a.length-1]&&(a=a.substr(0,a.length-1)),b(a,!0)?.01>a?(o.tipsError("单次支付金额不能低于￥0.01"),!1):a>2e4?(o.tipsError("单次支付金额不能超过￥20,000"),!1):(e={QRId:m||0,Code:l||0,UserId:c(),Amount:a,Remarks:$("#remarks").val()},o.showLoading(),$.post("http://"+n+"/api/SwiftPass/postswiftpassapipay",e,function(a){if(!a)return o.hideLoading(),o.tipsError("下单失败"),void 0;if(!a.flag)return o.hideLoading(),o.tipsError(a.msg),void 0;a=a.data,d(a.payVerify);var b=JSON.parse(a.payInfo);switch(a.payMentEnum){case 1:g(b,a);break;case 2:h(b,a);break;case 3:i(b,a);break;case 4:default:o.hideLoading(),o.tipsError("仅支持微信和支付宝付款")}},"json"),!1):(o.tipsError("请输入正确支付金额"),void 0)):(o.tipsError("获取店铺信息失败,请重新扫描"),void 0)}),$("#amount").focus()});